---
wts:
  title: 04 - 创建虚拟网络（20 分钟）
  module: Module 02 - Core Azure Services (Workloads)
ms.openlocfilehash: 08aafa461c0facc43e735bd81ba97aa9650952fa
ms.sourcegitcommit: 26c283fffdd08057fdce65fa29de218fff21c7d0
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/27/2022
ms.locfileid: "137907485"
---
# <a name="04---create-a-virtual-network-20-min"></a>04 - 创建虚拟网络（20 分钟）

在本演练中，我们将创建一个虚拟网络，将两个虚拟机部署到该虚拟网络上，然后配置它们以允许一个虚拟机通过该虚拟网络 ping 至另一个虚拟机。

# <a name="task-1-create-a-virtual-network"></a>任务 1：创建虚拟网络 

在此任务中，我们将创建虚拟网络。 

注意：在开始实验室之前，请通过打开“开始”菜单>“设置”>“网络和 Internet”>“查找 Windows 防火墙”，禁用虚拟机中的公共和专用防火墙

1. 通过 <a href="https://portal.azure.com" target="_blank"><span style="color: #0066cc;" color="#0066cc">https://portal.azure.com</span></a> 登录到 Azure 门户

2. 从“所有服务”边栏选项卡，搜索并选择“虚拟网络”，然后单击“+ 添加、+ 创建、+ 新建”  。 

3. 在“基本”选项卡上，填写以下信息（其他所有设置保留默认值）：

    | 设置 | Value | 
    | --- | --- |
    | 订阅 | 保留提供的默认值 |
    | 资源组 | **新建资源组** |
    | 名称 | vnet1 |
    | 区域 | **（美国）美国东部** |
    
   
4. 单击“审阅 + 创建”按钮。 确保验证通过。 然后点击“创建”来部署资源。


# <a name="task-2-create-two-virtual-machines"></a>任务 2：创建两个虚拟机

在此任务中，我们将在虚拟网络中创建两个虚拟机。 

1. 在“所有服务”边栏选项卡中，搜索“虚拟机”，然后单击“+ 添加、+ 创建、+ 新建”，从下拉列表中选择“虚拟机”   。 

2. 在“基本”选项卡上，填写以下信息（其他所有设置保留默认值）：

   | 设置 | Value | 
   | --- | --- |
   | 订阅 | 使用提供的默认值 |
   | 资源组 |  选择下拉列表中的默认值 |
   | 虚拟机名称 | **VM1**|
   | 区域 | **（美国）美国东部** |
   | 映像 | Windows Server 2019 Datacenter - Gen2 |
   | 用户名| **azureuser** |
   | 密码| **Pa$$w0rd1234** |
   | 公共入站端口| 选择“允许所选端口”  |
   | 选定的入站端口| **RDP (3389)** |
   

3. 选择“网络”选项卡。确保虚拟机位于 vnet1 虚拟网络中。 查看默认设置，但不要进行任何其他更改。 

4. 单击“查看 + 创建”。 验证通过后，单击“创建”。 部署时间可能有所不同，通常需要三到六分钟才能完成部署。

5. 监视你的部署，同时继续执行下一步。 

6. 通过重复上述步骤 2 至 4 创建第二个虚拟机。 请务必使用其他虚拟机名称，并确保该虚拟机位于同一虚拟网络中，并且使用新的公共 IP 地址：

    | 设置 | Value |
    | --- | --- |
    | 资源组 | 选择下拉列表中的默认值（与 Task1-3 和 Task2-2 相同） |
    | 虚拟机名称 |  vm2 |
    | 虚拟网络 | vnet1 |
    | 公共 IP | vm2-ip |

7. 等待两个虚拟机完成部署，其状态显示为“正在运行”。

# <a name="task-3-test-the-connection"></a>任务 3：测试连接 

在此任务中，我们将尝试测试虚拟机能否相互通信 (ping)。 如果不能，则安装一个支持 ICMP 连接的规则。 通常，系统会自动阻止 ICMP 连接。

1. 从“所有资源”边栏选项卡，搜索“vm1”，打开其“概述”边栏选项卡，并确保其“状态”为“正在运行”    。 可能需要刷新页面。

2. 在“概述”边栏选项卡上，选择“连接”并选择下拉列表中的“RDP”  。

    **注意**：以下说明介绍如何从 Windows 计算机连接到 VM。 

3. 在“使用 RDP 连接”边栏选项卡上，保留默认选项，按 IP 地址通过端口 3389 进行连接，然后单击“下载 RDP 文件” 。

4. 打开下载的 RDP 文件（位于 VM 的左下角）并在出现提示时单击“连接”。 

5. 在“Windows 安全性”窗口中，键入用户名“azureuser”和密码“Pa$$w0rd1234”，然后单击“确定”   。

6. 你可能会在登录过程中收到证书警告。 单击“是”创建连接并连接到已部署的 VM。 你应该成功连接。 关闭弹出的 Windows Server 和仪表板窗口。 此时会显示蓝色的 Windows 背景。 你现在已进入虚拟机。

7. 在两个新创建的虚拟机中，通过 RDP 进行连接，然后通过打开“开始”菜单>“设置”>“网络和 Internet”>“查找 Windows 防火墙”，禁用公共和专用防火墙。

8. 在虚拟机上打开 PowerShell：单击“开始”按钮，在“搜索”中键入“PowerShell”，然后依次右键单击“Windows PowerShell”和“以管理员身份运行”   。

9. 在 Powershell 中，尝试通过键入以下命令来 ping 通 vm2：

   ```PowerShell
   ping vm2
   ```

 10. 操作应该会成功。 现已从 VM1 ping 通 VM2。


祝贺你！ 你已在虚拟网络中配置并部署了两个虚拟机，现在可以连接它们了。

**注意**：为了避免产生额外费用，可以选择删除此资源组。 搜索资源组，单击你的资源组，然后单击“删除资源组”。 验证资源组的名称，然后单击“删除”。 关注“通知”，了解删除操作的进度。
